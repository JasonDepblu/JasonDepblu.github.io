---
layout: post
title: Search
permalink: /search/
date: 2024-12-3
author: Jason
---

<h1>Search</h1>

<!-- 添加搜索表单 -->
<form id="search-form" action="" method="get">
  <input type="text" id="search-input" name="q" placeholder="Search" autocomplete="off" autofocus>
</form>

<script>
  document.getElementById('search-form').addEventListener('submit', function(event) {
    event.preventDefault(); // 阻止表单默认提交
  });
</script>

<!-- 搜索结果容器 -->
<div id="results-container"></div>

<script>
  async function fetchPosts() {
    // 使用 Jekyll 的 site.baseurl 确保路径正确
    const response = await fetch('{{ site.baseurl }}/search.json');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const input = document.getElementById('search-input');
    const resultsContainer = document.getElementById('results-container');

    let posts = [];
    try {
      posts = await fetchPosts();
    } catch (error) {
      console.error('Failed to fetch search.json:', error);
      resultsContainer.innerHTML = '<p>Failed to load search data.</p>';
      return;
    }

    // 处理用户输入并过滤结果
    input.addEventListener('input', () => {
      const query = input.value.toLowerCase();
      const filteredPosts = posts.filter(post =>
        post.title.toLowerCase().includes(query) ||
        post.content.toLowerCase().includes(query)
      );

      // 显示搜索结果
      if (filteredPosts.length > 0) {
        resultsContainer.innerHTML = filteredPosts.map(post => `
          <div class="search-result">
            <a href="${post.url}">${post.title}</a> - ${new Date(post.date).toLocaleDateString()}
            <p>${post.content.slice(0, 100)}...</p> <!-- 可选：显示文章内容的部分 -->
          </div>
        `).join('');
      } else {
        resultsContainer.innerHTML = '<p>No results found.</p>';
      }
    });
  });
</script>