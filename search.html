---
layout: post
title: Comunication
permalink: /search/
date: 2024-12-3
author: Jason
---
<h1>Q & A</h1>
<!-- search.html 的主体部分 -->
<div id="chat-container">
  <div id="chat-log"><!-- 动态插入对话 --></div>
  <div id="input-area">
    <textarea id="question" placeholder="请输入您的问题..."></textarea>
    <button id="send-btn">提交</button>
  </div>
</div>

<!-- 引入 Markdown 渲染库 -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  // 前端脚本：发送提问，接收回答并更新UI
  const sendBtn = document.getElementById('send-btn');
  const questionInput = document.getElementById('question');
  const chatLog = document.getElementById('chat-log');

  sendBtn.onclick = async () => {
    const question = questionInput.value.trim();
    if (!question) return;
    // 在界面添加用户提问
    appendMessage('user', question);
    questionInput.value = '';  // 清空输入框

    // 调用后端 API 获取回答
    try {
      const res = await fetch('https://jasondepblu.netlify.app/.netlify/functions/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
      });
      const data = await res.json();
      const answerMarkdown = data.answer;
      // 使用 marked 将Markdown转为HTML
      const answerHtml = marked.parse(answerMarkdown);
      appendMessage('ai', answerHtml);
    } catch(err) {
      console.error('API 调用失败:', err);
      appendMessage('ai', '<p>抱歉，获取回答失败。</p>');
    }
  };

  function appendMessage(sender, content) {
    const msgDiv = document.createElement('div');
    msgDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
    // 如果是AI消息，content可能是HTML字符串
    msgDiv.innerHTML = sender === 'user' ?
      `<p>${content}</p>` : content;
    chatLog.appendChild(msgDiv);
    chatLog.scrollTop = chatLog.scrollHeight; // 滚动到底部
  }
</script>