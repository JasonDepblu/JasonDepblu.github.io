{"ast":null,"code":"// src/components/ChatBot.jsx\nimport React,{useState,useEffect,useCallback}from'react';import MessageList from'./MessageList';import ChatInput from'./ChatInput';import StreamToggle from'./StreamToggle';import useLocalStorage from'../hooks/useLocalStorage';import useChatApi from'../hooks/useChatApi';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ChatBot(){// 状态管理\nconst[messages,setMessages]=useState([]);const[sessionId,setSessionId]=useLocalStorage('chatSessionId',null);const[useStream,setUseStream]=useState(true);const[thinking,setThinking]=useState(null);const[isProcessing,setIsProcessing]=useState(false);// 使用自定义Hook进行API通信\nconst{initiateRequest,handleStreamingResponse,pollForResult,checkAnswer,streamFailureCount}=useChatApi(sessionId,setSessionId);// 处理流式响应失败时的UI反馈\nuseEffect(()=>{if(streamFailureCount>=3&&useStream){setUseStream(false);addMessage('ai','已自动关闭流式响应模式，因为检测到多次连接失败。',false,true);}},[streamFailureCount,useStream]);// 添加消息到聊天记录\nconst addMessage=useCallback(function(type,content){let isStreaming=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let error=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;setMessages(prev=>[...prev,{type,content,isStreaming,error}]);},[]);// 更新流式消息内容\nconst updateStreamMessage=useCallback(content=>{console.log(\"Updating stream message, content length:\",content.length);setMessages(prev=>{const newMessages=[...prev];const lastIndex=newMessages.length-1;if(lastIndex>=0&&newMessages[lastIndex].isStreaming){newMessages[lastIndex]={...newMessages[lastIndex],content};}return newMessages;});},[]);// 检查特定请求的结果\nconst handleCheckAnswer=useCallback(async requestId=>{const thinkingId='checking-'+Date.now();setThinking({id:thinkingId,text:'检查结果中'});setIsProcessing(true);try{const result=await checkAnswer(requestId);setThinking(null);handleResult(result);}catch(error){setThinking(null);addMessage('ai',`检查失败: ${error.message}`,false,true);}finally{setIsProcessing(false);}},[addMessage,checkAnswer]);// 处理API结果 - 修复版本\n// 3. src/components/ChatBot.jsx - 修改handleResult部分\nconst handleResult=useCallback(result=>{if(result.status===\"timeout\"){// 超时但仍在处理 - 使用结构化对象而非HTML字符串\naddMessage('ai',{type:'processing-message',message:result.message,requestId:result.requestId},false,false);return;}console.log(`处理结果: status=${result.status}, hasAnswer=${!!result.answer}`);if(result.answer){// 更新会话ID\nif(result.sessionId){setSessionId(result.sessionId);}// 渲染回答\naddMessage('ai',result.answer);}else if(result.status===\"error\"){// 处理错误\naddMessage('ai',result.error||'处理完成，但没有获得回答',false,true);}else{// 没有回答\naddMessage('ai','处理完成，但没有获得回答',false,true);}},[addMessage,setSessionId]);const pollWithThinkingUpdates=useCallback(async(requestId,sessionId)=>{let attempts=0;let pollResult;do{// 更新思考状态\nsetThinking(prev=>({...prev,attempts:attempts}));// 执行轮询\npollResult=await pollForResult(requestId,sessionId,attempts);attempts++;// 如果完成或失败，退出循环\nif(pollResult.status==='completed'||pollResult.status==='failed'||pollResult.status==='error'||pollResult.status==='timeout'){break;}// 等待下一次轮询\nawait new Promise(resolve=>setTimeout(resolve,2000));}while(attempts<30);// 避免无限循环\nreturn pollResult;},[pollForResult]);// 处理用户发送的消息\nconst handleSendMessage=useCallback(async question=>{if(!question.trim())return;// 禁用输入，显示处理状态\nsetIsProcessing(true);// 添加用户消息到UI\naddMessage('user',question);// 添加\"思考中\"的提示\nconst thinkingId='thinking-'+Date.now();setThinking({id:thinkingId,attempts:0});try{console.log(`发送问题: ${question}`);const result=await initiateRequest(question,useStream);console.log(\"initiateRequest 结果:\",{directAnswer:result.directAnswer,hasStreamConfig:!!result.streamConfig,requestId:result.requestId,sessionId:result.sessionId});// 更新会话ID\nif(result.sessionId){setSessionId(result.sessionId);console.log(`更新会话ID: ${result.sessionId}`);}// 1. 处理直接回答\nif(result.directAnswer){console.log(\"收到直接回答\");setThinking(null);addMessage('ai',result.answer);return;}if(result.streamConfig){var _result$streamConfig,_result$streamConfig2,_result$streamConfig3,_result$streamConfig4,_result$streamConfig5;console.log(\"流式配置详情:\",{hasEndpoint:!!((_result$streamConfig=result.streamConfig)!==null&&_result$streamConfig!==void 0&&_result$streamConfig.apiEndpoint),hasApiKey:!!((_result$streamConfig2=result.streamConfig)!==null&&_result$streamConfig2!==void 0&&_result$streamConfig2.apiKey),model:(_result$streamConfig3=result.streamConfig)===null||_result$streamConfig3===void 0?void 0:_result$streamConfig3.model,messagesCount:(_result$streamConfig4=result.streamConfig)===null||_result$streamConfig4===void 0?void 0:(_result$streamConfig5=_result$streamConfig4.messages)===null||_result$streamConfig5===void 0?void 0:_result$streamConfig5.length});}// 2. 处理流式响应\nif(result.streamConfig&&useStream){console.log(\"开始流式响应处理\");setThinking(null);// 添加初始流式消息\naddMessage('ai','',true);// 开始流式传输\nconst streamResult=await handleStreamingResponse(result.streamConfig,updateStreamMessage);if(streamResult!==false){// Update the message to mark it as no longer streaming\nsetMessages(prev=>{const newMessages=[...prev];const lastIndex=newMessages.length-1;if(lastIndex>=0&&newMessages[lastIndex].isStreaming){newMessages[lastIndex]={...newMessages[lastIndex],isStreaming:false// Set streaming to false\n};}return newMessages;});}// 如果流式传输失败，回退到轮询\nif(streamResult===false){console.log(\"流式传输失败，回退到轮询\");if(result.requestId&&result.sessionId){const pollResult=await pollForResult(result.requestId,result.sessionId,0);handleResult(pollResult);}}return;}// 3. 标准轮询处理\nif(result.requestId&&result.sessionId){console.log(`开始轮询结果: ${result.requestId}`);// 更新思考状态以显示不同的文本\nlet attempts=0;const pollWithUpdatingThinking=async()=>{setThinking(prev=>({...prev,attempts:attempts}));const pollResult=await pollForResult(result.requestId,result.sessionId,attempts);attempts++;return pollResult;};const pollResult=await pollWithUpdatingThinking();setThinking(null);handleResult(pollResult);}else{console.error(\"缺少必要的ID:\",{hasRequestId:!!result.requestId,hasSessionId:!!result.sessionId});setThinking(null);addMessage('ai','无法获取请求ID或会话ID，请重试',false,true);}}catch(err){// 移除思考中状态\nsetThinking(null);console.error('处理失败:',err);addMessage('ai',`获取回答失败: ${err.message}`,false,true);}finally{// 恢复输入状态\nsetIsProcessing(false);}},[addMessage,handleResult,handleStreamingResponse,initiateRequest,pollForResult,updateStreamMessage,useStream,setSessionId]);// 清除会话\nconst handleClearSession=useCallback(()=>{if(window.confirm('确定要开始新的对话吗？这将清除当前的对话历史。')){localStorage.removeItem('chatSessionId');setSessionId(null);setMessages([]);addMessage('ai','已开始新的对话。');}},[addMessage,setSessionId]);// 切换流式响应模式\nconst handleToggleStream=useCallback(e=>{setUseStream(e.target.checked);},[]);return/*#__PURE__*/_jsxs(\"div\",{id:\"chat-container\",children:[/*#__PURE__*/_jsx(MessageList,{messages:messages,thinking:thinking,checkAnswerHandler:handleCheckAnswer}),/*#__PURE__*/_jsx(ChatInput,{onSendMessage:handleSendMessage,disabled:isProcessing}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(StreamToggle,{checked:useStream,onChange:handleToggleStream}),/*#__PURE__*/_jsx(\"button\",{id:\"clear-session\",onClick:handleClearSession,title:\"\\u5F00\\u59CB\\u65B0\\u7684\\u5BF9\\u8BDD\\uFF0C\\u6E05\\u9664\\u5BF9\\u8BDD\\u5386\\u53F2\",children:\"\\u65B0\\u5BF9\\u8BDD\"})]})]});}export default ChatBot;","map":{"version":3,"names":["React","useState","useEffect","useCallback","MessageList","ChatInput","StreamToggle","useLocalStorage","useChatApi","jsx","_jsx","jsxs","_jsxs","ChatBot","messages","setMessages","sessionId","setSessionId","useStream","setUseStream","thinking","setThinking","isProcessing","setIsProcessing","initiateRequest","handleStreamingResponse","pollForResult","checkAnswer","streamFailureCount","addMessage","type","content","isStreaming","arguments","length","undefined","error","prev","updateStreamMessage","console","log","newMessages","lastIndex","handleCheckAnswer","requestId","thinkingId","Date","now","id","text","result","handleResult","message","status","answer","pollWithThinkingUpdates","attempts","pollResult","Promise","resolve","setTimeout","handleSendMessage","question","trim","directAnswer","hasStreamConfig","streamConfig","_result$streamConfig","_result$streamConfig2","_result$streamConfig3","_result$streamConfig4","_result$streamConfig5","hasEndpoint","apiEndpoint","hasApiKey","apiKey","model","messagesCount","streamResult","pollWithUpdatingThinking","hasRequestId","hasSessionId","err","handleClearSession","window","confirm","localStorage","removeItem","handleToggleStream","e","target","checked","children","checkAnswerHandler","onSendMessage","disabled","className","onChange","onClick","title"],"sources":["/Users/depblu/Documents/GitHub/JasonDepblu.github.io/src/components/ChatBot.jsx"],"sourcesContent":["// src/components/ChatBot.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport MessageList from './MessageList';\nimport ChatInput from './ChatInput';\nimport StreamToggle from './StreamToggle';\nimport useLocalStorage from '../hooks/useLocalStorage';\nimport useChatApi from '../hooks/useChatApi';\n\nfunction ChatBot() {\n  // 状态管理\n  const [messages, setMessages] = useState([]);\n  const [sessionId, setSessionId] = useLocalStorage('chatSessionId', null);\n  const [useStream, setUseStream] = useState(true);\n  const [thinking, setThinking] = useState(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // 使用自定义Hook进行API通信\n  const {\n    initiateRequest,\n    handleStreamingResponse,\n    pollForResult,\n    checkAnswer,\n    streamFailureCount\n  } = useChatApi(sessionId, setSessionId);\n\n  // 处理流式响应失败时的UI反馈\n  useEffect(() => {\n    if (streamFailureCount >= 3 && useStream) {\n      setUseStream(false);\n      addMessage('ai', '已自动关闭流式响应模式，因为检测到多次连接失败。', false, true);\n    }\n  }, [streamFailureCount, useStream]);\n\n  // 添加消息到聊天记录\n  const addMessage = useCallback((type, content, isStreaming = false, error = false) => {\n    setMessages(prev => [...prev, { type, content, isStreaming, error }]);\n  }, []);\n\n  // 更新流式消息内容\n  const updateStreamMessage = useCallback((content) => {\n    console.log(\"Updating stream message, content length:\", content.length);\n    setMessages(prev => {\n      const newMessages = [...prev];\n      const lastIndex = newMessages.length - 1;\n\n      if (lastIndex >= 0 && newMessages[lastIndex].isStreaming) {\n        newMessages[lastIndex] = {\n          ...newMessages[lastIndex],\n          content\n        };\n      }\n\n      return newMessages;\n    });\n  }, []);\n\n  // 检查特定请求的结果\n  const handleCheckAnswer = useCallback(async (requestId) => {\n    const thinkingId = 'checking-' + Date.now();\n    setThinking({\n      id: thinkingId,\n      text: '检查结果中'\n    });\n    setIsProcessing(true);\n\n    try {\n      const result = await checkAnswer(requestId);\n      setThinking(null);\n      handleResult(result);\n    } catch (error) {\n      setThinking(null);\n      addMessage('ai', `检查失败: ${error.message}`, false, true);\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [addMessage, checkAnswer]);\n\n  // 处理API结果 - 修复版本\n  // 3. src/components/ChatBot.jsx - 修改handleResult部分\n  const handleResult = useCallback((result) => {\n    if (result.status === \"timeout\") {\n      // 超时但仍在处理 - 使用结构化对象而非HTML字符串\n      addMessage('ai', {\n        type: 'processing-message',\n        message: result.message,\n        requestId: result.requestId\n      }, false, false);\n      return;\n    }\n    console.log(`处理结果: status=${result.status}, hasAnswer=${!!result.answer}`);\n\n    if (result.answer) {\n      // 更新会话ID\n      if (result.sessionId) {\n        setSessionId(result.sessionId);\n      }\n\n      // 渲染回答\n      addMessage('ai', result.answer);\n    } else if (result.status === \"error\") {\n      // 处理错误\n      addMessage('ai', result.error || '处理完成，但没有获得回答', false, true);\n    } else {\n      // 没有回答\n      addMessage('ai', '处理完成，但没有获得回答', false, true);\n    }\n  }, [addMessage, setSessionId]);\n\n  const pollWithThinkingUpdates = useCallback(async (requestId, sessionId) => {\n    let attempts = 0;\n    let pollResult;\n\n    do {\n      // 更新思考状态\n      setThinking(prev => ({\n        ...prev,\n        attempts: attempts\n      }));\n\n      // 执行轮询\n      pollResult = await pollForResult(requestId, sessionId, attempts);\n      attempts++;\n\n      // 如果完成或失败，退出循环\n      if (pollResult.status === 'completed' || pollResult.status === 'failed' ||\n          pollResult.status === 'error' || pollResult.status === 'timeout') {\n        break;\n      }\n\n      // 等待下一次轮询\n      await new Promise(resolve => setTimeout(resolve, 2000));\n    } while (attempts < 30); // 避免无限循环\n\n    return pollResult;\n  }, [pollForResult]);\n\n  // 处理用户发送的消息\n  const handleSendMessage = useCallback(async (question) => {\n    if (!question.trim()) return;\n\n    // 禁用输入，显示处理状态\n    setIsProcessing(true);\n\n    // 添加用户消息到UI\n    addMessage('user', question);\n\n    // 添加\"思考中\"的提示\n    const thinkingId = 'thinking-' + Date.now();\n    setThinking({\n      id: thinkingId,\n      attempts: 0\n    });\n\n    try {\n      console.log(`发送问题: ${question}`);\n      const result = await initiateRequest(question, useStream);\n      console.log(\"initiateRequest 结果:\", {\n        directAnswer: result.directAnswer,\n        hasStreamConfig: !!result.streamConfig,\n        requestId: result.requestId,\n        sessionId: result.sessionId\n      });\n\n      // 更新会话ID\n      if (result.sessionId) {\n        setSessionId(result.sessionId);\n        console.log(`更新会话ID: ${result.sessionId}`);\n      }\n\n      // 1. 处理直接回答\n      if (result.directAnswer) {\n        console.log(\"收到直接回答\");\n        setThinking(null);\n        addMessage('ai', result.answer);\n        return;\n      }\n\n      if (result.streamConfig) {\n        console.log(\"流式配置详情:\", {\n          hasEndpoint: !!result.streamConfig?.apiEndpoint,\n          hasApiKey: !!result.streamConfig?.apiKey,\n          model: result.streamConfig?.model,\n          messagesCount: result.streamConfig?.messages?.length\n        });\n      }\n\n      // 2. 处理流式响应\n      if (result.streamConfig && useStream) {\n        console.log(\"开始流式响应处理\");\n        setThinking(null);\n\n        // 添加初始流式消息\n        addMessage('ai', '', true);\n\n        // 开始流式传输\n        const streamResult = await handleStreamingResponse(\n          result.streamConfig,\n          updateStreamMessage\n        );\n\n        if (streamResult !== false) {\n            // Update the message to mark it as no longer streaming\n          setMessages(prev => {\n            const newMessages = [...prev];\n            const lastIndex = newMessages.length - 1;\n\n            if (lastIndex >= 0 && newMessages[lastIndex].isStreaming) {\n              newMessages[lastIndex] = {\n                ...newMessages[lastIndex],\n                isStreaming: false  // Set streaming to false\n              };\n            }\n\n          return newMessages;\n          });\n        }\n\n        // 如果流式传输失败，回退到轮询\n        if (streamResult === false) {\n          console.log(\"流式传输失败，回退到轮询\");\n          if (result.requestId && result.sessionId) {\n            const pollResult = await pollForResult(result.requestId, result.sessionId, 0);\n            handleResult(pollResult);\n          }\n        }\n        return;\n      }\n\n      // 3. 标准轮询处理\n      if (result.requestId && result.sessionId) {\n        console.log(`开始轮询结果: ${result.requestId}`);\n\n        // 更新思考状态以显示不同的文本\n        let attempts = 0;\n        const pollWithUpdatingThinking = async () => {\n          setThinking(prev => ({\n            ...prev,\n            attempts: attempts\n          }));\n\n          const pollResult = await pollForResult(result.requestId, result.sessionId, attempts);\n          attempts++;\n\n          return pollResult;\n        };\n\n        const pollResult = await pollWithUpdatingThinking();\n        setThinking(null);\n        handleResult(pollResult);\n      } else {\n        console.error(\"缺少必要的ID:\", {\n          hasRequestId: !!result.requestId,\n          hasSessionId: !!result.sessionId\n        });\n        setThinking(null);\n        addMessage('ai', '无法获取请求ID或会话ID，请重试', false, true);\n      }\n    } catch (err) {\n      // 移除思考中状态\n      setThinking(null);\n      console.error('处理失败:', err);\n      addMessage('ai', `获取回答失败: ${err.message}`, false, true);\n    } finally {\n      // 恢复输入状态\n      setIsProcessing(false);\n    }\n  }, [\n    addMessage,\n    handleResult,\n    handleStreamingResponse,\n    initiateRequest,\n    pollForResult,\n    updateStreamMessage,\n    useStream,\n    setSessionId\n  ]);\n\n  // 清除会话\n  const handleClearSession = useCallback(() => {\n    if (window.confirm('确定要开始新的对话吗？这将清除当前的对话历史。')) {\n      localStorage.removeItem('chatSessionId');\n      setSessionId(null);\n      setMessages([]);\n      addMessage('ai', '已开始新的对话。');\n    }\n  }, [addMessage, setSessionId]);\n\n  // 切换流式响应模式\n  const handleToggleStream = useCallback((e) => {\n    setUseStream(e.target.checked);\n  }, []);\n\n  return (\n    <div id=\"chat-container\">\n\n      <MessageList\n        messages={messages}\n        thinking={thinking}\n        checkAnswerHandler={handleCheckAnswer}\n      />\n\n      <ChatInput\n        onSendMessage={handleSendMessage}\n        disabled={isProcessing}\n      />\n\n      <div className=\"controls\">\n        <StreamToggle\n          checked={useStream}\n          onChange={handleToggleStream}\n        />\n\n        <button\n          id=\"clear-session\"\n          onClick={handleClearSession}\n          title=\"开始新的对话，清除对话历史\"\n        >\n          新对话\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default ChatBot;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}